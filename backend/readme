Here is the same content formatted **nicely as clean plaintext** (no Markdown, no emojis, easy to read / copy / paste):

---

to run server

npm run dev

auth signup endpoint
[http://localhost:5000/api/auth/signup](http://localhost:5000/api/auth/signup)

---



---

BIG PICTURE (How your backend works)

Request → Routes → Middleware → Controller → Model → Database

Now let’s map your files into this flow.

---

backend/

This is your entire server.

---

node_modules/

• Installed npm packages
• Never touch
• Auto-generated

---

src/

ALL your actual backend logic lives here.

---

src/config/

Purpose: Configuration & environment setup

Typical use:
• Load .env
• Database connection
• Global configs

Example:
mongoose.connect(process.env.MONGO_URI)

If backend breaks at startup, the problem is usually here.

---

src/controllers/

Purpose: Actual business logic
“What should happen when a request comes in?”

authController.ts

Handles authentication logic:
• Signup
• Login
• Create JWT token
• Compare passwords

Example responsibilities:
signup()
login()

This is where your JWT token is generated.

---

imagePostController.ts

Handles image post logic:
• Create image post
• Like/unlike post
• Fetch posts

Example:
createImagePost()
toggleLikePost()
getAllImagePosts()

If image upload fails, the problem is usually here or in the upload middleware.

---

src/middleware/

Purpose: Gatekeepers
Code that runs BEFORE controllers.

---

authMiddleware.ts

MOST IMPORTANT FILE FOR YOUR CURRENT ISSUE

What it does:
• Reads Authorization: Bearer <token>
• Verifies JWT
• Attaches user to request

Example:
req.user = decodedUser;

If this fails → 401 Unauthorized

---

roleMiddleware.ts

Checks user role (business / user / admin)

Example:
if (req.user.userType !== "business") {
return res.status(403)
}

Used when only some users can access a route.

---

upload.ts

Handles file uploads using multer.

What it does:
• Accepts multipart/form-data
• Saves images to /uploads
• Defines file limits & storage

Example:
upload.array("images", 4)

If images don’t arrive, the issue is here.

---

src/models/

Purpose: Database structure (MongoDB schemas)

---

User.ts

User schema

Defines:
• email
• username
• password
• userType

Used by:
• authController
• authMiddleware

---

ImagePost.ts

Image post schema

Defines:
• user
• images[]
• title
• description
• likes
• comments allowed

Used by:
• imagePostController

---

TestItem.ts

Likely:
• Testing / dummy schema
• Safe to ignore unless used

---

src/routes/

Purpose: URL definitions
“Which controller runs for which URL?”

---

authRoutes.ts

Defines auth URLs:
POST /api/auth/signup
POST /api/auth/login
GET  /api/auth/ping

Maps to authController.

---

imagePostRoutes.ts

Defines image post URLs:
POST /api/images/create
PUT  /api/images/like/:id
GET  /api/images

Maps to imagePostController.

---

src/types/express/

Purpose: TypeScript fix for Express.

---

index.d.ts

Extends Express types.

Why needed?
Because you do:
req.user = decodedUser

Express doesn’t know "user" exists.
This file tells TypeScript:

Request {
user?: IUser
}

Without this → TypeScript errors.

---

src/utils/

Purpose: Helper utilities.

---

cloudflare.ts

Handles:
• Cloudflare image upload
• Image URLs
• CDN logic

If you move images to cloud, this is used.

---

index.ts

General helper exports.

---

uploads/

Purpose: Stored uploaded images.

Images are physically saved here:
uploads/high/1768268733080-0.jpg

If images exist here → upload worked
If empty → multer failed

---

How your IMAGE UPLOAD request flows

When you click Publish:

Frontend
→ POST /api/images/create
→ imagePostRoutes.ts
→ requireAuth (authMiddleware)
→ upload.array("images")
→ createImagePost (controller)
→ ImagePost model
→ MongoDB

---

Why you’re seeing "Unauthorized"

The problem is NOT frontend anymore.

It is in:
middleware/authMiddleware.ts

Possible causes:
• Token missing
• Token expired
• JWT_SECRET mismatch
• req.user not set

---

TL;DR (Very short)

controllers       → Logic
middleware        → Security & checks
models            → Database schema
routes            → URLs
upload.ts         → File upload
authMiddleware.ts → JWT verification
uploads           → Saved images

---

If you want next, I can:
• Walk through authMiddleware.ts line by line
• Show exactly why Unauthorized happens
• Fix JWT mismatch permanently
• Draw request flow for debugging

Just tell me which file you want explained line by line.
